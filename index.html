<!DOCTYPE html>
<html lang="pt-br">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Controle de Empréstimos</title>
  <link rel="stylesheet" href="styles.css">
</head>

<body>

  <!-- Loader de transição entre páginas -->
<div id="page-loader" aria-hidden="true">
  <div class="pl-card">
    <div class="pl-spinner"></div>
    <p>Carregando…</p>
  </div>
</div>


  <header class="main-header" id="mainHeader">
    <div class="logo">
      <a href="index.html" aria-label="Página inicial">
        <img src="./img/logo bossa almoxarifado 2025.png" alt="Logo da Empresa">
      </a>
    </div>

    <nav class="menu">
      <ul>
        <li><a href="index.html">Início</a></li>
        <li><a href="./estoque.html">Estoque</a></li>
        <li><a href="./registro.html">Registros</a></li>
      </ul>
    </nav>

    <div class="user-icon">
      <img src="./img/icon-img.webp" alt="Ícone do Usuário">
    </div>

    <div class="logout-button" id="logoutButton">
      <a href="login.html">Sair</a>
    </div>
  </header>

  <div class="banner-topo"></div>

  <main class="container">
    <section class="emprestimo-form-section">
      <h2>Registrar Empréstimo</h2>
      <form id="emprestimoForm">
        <div class="form-group">
          <label for="descricao">Materiais/Ferramentas:</label>
          <input type="text" id="descricao" name="descricao"
            placeholder="Ex: Serra Sabre, (2) Extensão" list="sugestoesMateriais" required />
          <datalist id="sugestoesMateriais"></datalist>
        </div>

        <div class="form-group">
          <label for="quantidade">Quantidade Padrão:</label>
          <input type="number" id="quantidade" name="quantidade" min="1" value="1" required>
        </div>

        <div class="form-group">
          <label for="nomeFuncionario">Nome do Funcionário:</label>
          <input type="text" id="nomeFuncionario" name="nomeFuncionario"
            placeholder="Nome do responsável" required>
        </div>

        <div class="form-group">
          <label for="nomeEmpresa">Nome da Empresa:</label>
          <select id="nomeEmpresa" name="nomeEmpresa" required>
            <option value="" disabled selected>Selecione uma empresa</option>
          </select>
        </div>

        <button type="submit">Registrar Empréstimo</button>
      </form>
    </section>

    <section id="emprestimosContainer">
      <div id="emprestimosPorFuncionarioContainer">
        <p>A carregar empréstimos...</p>
      </div>
    </section>
  </main>

  <script>
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('sw.js')
        .then(() => console.log('Service Worker registrado com sucesso'))
        .catch(err => console.log('Erro ao registrar Service Worker', err));
    }
  </script>

  <script type="module" src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app.js"></script>
  <script type="module" src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore.js"></script>
  <script type="module" src="script.js"></script>

  <script>
(function initPageLoader(){
  const loader = document.getElementById('page-loader');
  if (!loader) return;

  // Exibe um pouco ao entrar (deixa a transição bonita ao recarregar)
  const MIN_MS = 500; // aumente se quiser ver por mais tempo ao entrar
  const start = Date.now();
  loader.classList.add('show');
  window.addEventListener('load', () => {
    const elapsed = Date.now() - start;
    const delay = Math.max(0, MIN_MS - elapsed);
    setTimeout(() => loader.classList.remove('show'), delay);
  });

  // Helpers
  const isMod = (e) => e.button!==0 || e.metaKey || e.ctrlKey || e.shiftKey || e.altKey;
  const shouldBypass = (a) => {
    const href = a.getAttribute('href') || '';
    if (!href) return true;
    if (href.startsWith('#') || href.startsWith('javascript:')) return true;
    if (a.target && a.target.toLowerCase()==='_blank') return true;
    if (a.hasAttribute('download')) return true;
    const u = new URL(href, location.href);
    if (u.protocol==='mailto:' || u.protocol==='tel:') return true;
    if (u.origin !== location.origin) return true; // externo
    return false;
  };
  const isSameDoc = (url) => {
    const u = new URL(url, location.href);
    return u.origin===location.origin &&
           u.pathname.replace(/\/+$/,'')===location.pathname.replace(/\/+$/,'') &&
           (u.search||'')===(location.search||'');
  };

  // Intercepta cliques em <a>
  document.addEventListener('click', (e) => {
    const a = e.target.closest('a[href]');
    if (!a) return;
    if (isMod(e)) return;             // nova aba, etc.
    if (shouldBypass(a)) return;      // #, externo, _blank...
    if (isSameDoc(a.href)) return;    // evita recarregar o mesmo doc
    e.preventDefault();
    loader.classList.add('show');
    setTimeout(() => { window.location.href = a.href; }, 150); // tempo pro overlay aparecer
  }, true);

  // Mostra loader ao sair por outros meios
  window.addEventListener('beforeunload', () => {
    loader.classList.add('show');
  });
})();
</script>


</body>

</html>
